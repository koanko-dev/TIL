## 자바스크립트 엔진
자바스크립트 엔진은 자바스크립트를 실행하기 위해 필요한 엔진입니다.  
자바스크립트 코드를 해석하고 실행하는 프로그램 및 인터프리터의 역할을 합니다.

대표적인 자바스크립트 엔진으로는 V8이 있습니다. 구글에서 내놨고 가장 대중적입니다.

자바스크립트 엔진의 주요 구성 요소
- 메모리 힙(Memory Heap): 메모리 할당이 일어나는 곳
- 콜 스택(Call Stack): 호출 스택이 쌓이는 곳

## 자바스크립트 런타임이란?

## 자바스크립트 런타임 구조
자바스크립트 런타임에는 힙 저장소 하나와, 스택이 하나 있습니다.  
힙은 랜덤한 순서로 메모리를 저장할 수 있는 메모리 저장 장치입니다. 변수나 함수가 선언되면 이 곳에 값들이 저장된다고 생각하면 됩니다. 힙은 자바스크립트 런타임에 의해 관리됩니다. ([힙에 대한 자세한 설명](https://hashnode.com/post/does-javascript-use-stack-or-heap-for-memory-allocation-or-both-cj5jl90xl01nh1twuv8ug0bjk))  

## 실행 스택(Execution Stack)
실행 스택(Execution Stack)은 자바스크립트의 실행 컨텍스트를 저장하는 곳입니다. 콜스택(Call Stack)이라고도 부르며 그 외에도 Program Stack, Runtime Stack 등이 있는데 모두 같은 것을 칭하는 다른 이름입니다. 스택은 LIFO(Last In First Out) 자료구조를 가집니다.   

실행 스택의 한 단계를 스택 프레임(Stack Frame)이라고 합니다.  
<!-- 이미지 -->

실행 스택은 정해진 스택 사이즈가 있습니다. 이것을 초과하면 stack overflow 라고 하는 현상이 일어납니다. 말 그대로 스택이 넘쳐난겁니다. 무한루프의 발생한 경우가 바로 이 stack overflow 되어 일어나는 것입니다.

<!-- 이미지 -->

## 싱글스레드와 단점
자바스크립트는 기본적으로 싱글 스레드(Single Thread) 기반 언어입니다. 이 말이 뜻하는 것은 위에서 봤듯 가지는 호출 스택이 하나라는 겁니다. 프로세스당 하나의 스택과 하나의 힙만 있습니다. 따라서, 한 번에 한 작업만 처리 할 수 있습니다.  

호출 스택이 하나라면, 한 작업이 완료되어야 다른 작업을 차례대로 작업하게 됩니다. 즉, 다른 작업 수행하려면 지금 수행중인 작업이 끝나야 하는 문제가 있습니다.  
사용자가 HTTP 요청을 보내는 경우라면 어떻게 될까요? 요청이 완료될 때까지 브라우저가 정지될 겁니다. 그럼 매우 나쁜 사용자 경험을 하게 됩니다. 시간이 많이 걸리는 작업을 하면 프로그램이 느려질 가능성 존재한다는 겁니다.

자바스크립트 런타임은 이것을 해결하는 효율적인 방법이 있습니다.  
Web API, Callback Queue, Event Loop를 이용해 오래 걸리는 작업을 백그라운드에서 처리하고, 간단한 작업은 콜스택에서 처리하는 것입니다.

## 다시 정리하는, 자바스크립트 런타임
사실 브라우저의 내부에서 자바스크립트 런타임은 이렇게 동작합니다.  
2개의 추가 구성요소를 더 가집니다. 바로 Callback Queue, Event Loop 입니다.
<!-- 이미지 -->

## Web API
웹 브라우저에서 제공하는 기능들. Ajax, setTimeout(), 이벤트 핸들러 등
개발자 도구 window 찍으면 나온다.
Web API를 사용해 백그라운드에서 비동기적으로 작업 처리 가능. 끝나면 자바스크립트 콜스택에게 끝난걸 알려줌. 그럼 계속 작업 가능
setTimeout 처리는 여기서 일어난다. 시간이 끝나면 콜백 큐로 보내짐.

? 어떤게 더 있는지 알아볼 필요 있음

## 콜백 큐(Callback Queue / Message Queue / Task Queue)
비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 곳
? 처리가 끝난 함수가 대기하고 있는 곳이다. 콜 스택에 들어가기 위해서.


## 이벤트 루프(Event Loop)
콜 스택에 실행중인 컨텍스트 있는지, 콜백 큐에 대기중인 함수가 있는지 반복해서 계속 확인하는 것이 이벤트 루프.
콜 스택 비어있으면, 이벤트 루프는 FIFO(First In First Out)로 콜백 큐에 대기중인 함수를 콜 스택으로 이동시킴.


## 예시
<!-- 이미지 -->


## 결론
자바스크립트 엔진은 싱글 스레드로 동작
브라우저는 멀티스레드로 동작. 싱글 스레드로 동작하는 건 브라우저에 내장된 자바스크립트 엔진.
비동기 처리가 가능한 것은
이는 web API, Callback Quese, Event Loop 때문에 가능한 것은

## Reference.
- [How does JavaScript and JavaScript engine work in the browser and node?](https://medium.com/jspoint/how-javascript-works-in-browser-and-node-ab7d0d09ac2f)